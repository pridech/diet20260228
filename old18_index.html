<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2025餐厅评价年度报告</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            font-family: "WPS灵秀黑", "微软雅黑", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            overflow: hidden;
            background: #000;
        }
        #playOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: #fff;
            font-size: 1.6em;
            text-align: center;
            pointer-events: auto;
        }
        .page-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }
        section {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            opacity: 0;
            transition: opacity 0.8s ease;
            z-index: 0;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            padding-top: 40px; /* 整体向上调整 */
        }
        section.active {
            opacity: 1;
            z-index: 10;
        }
        .video-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        .video-bg.played {
            opacity: 1;
        }
        .page-content {
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center; /* 全局水平居中 */
        }
        ::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
        }
        /* 文字样式统一 */
        .text-large { font-size: 3.2em; font-weight: 700; line-height: 1.4; }
        .text-medium-large { font-size: 1.8em; font-weight: 600; text-align: center; white-space: nowrap; } /* 排名页标题缩小字号 */
        .text-medium { font-size: 1.8em; font-weight: 500; text-align: center; }
        .text-small { font-size: 1.4em; font-weight: 400; text-align: center; }
        .text-tiny { font-size: 0.9em; font-weight: 300; text-align: center; }
        /* 第1页专属样式 */
        .page1 .page-content {
            justify-content: center;
            align-items: center;
            height: 100%;
            padding-top: 0; /* 彻底上移避开小狗 */
        }
        .page1 .title {
            margin-bottom: 30px;
            opacity: 0;
            animation: fadeIn 0.7s ease 0.3s forwards;
            text-align: center;
            color: #fff; /* 白色文字 */
        }
        .page1 .subtitle {
            opacity: 0;
            animation: fadeIn 0.7s ease 0.5s forwards;
            text-align: center;
            color: #fff; /* 白色文字 */
        }
        /* 2-4页样式 - 白色文字 */
        .page2 .stats, .page3 .comparison, .page4 .scores {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
            color: #fff; /* 改为白色 */
        }
        .page2 .text-large, .page3 .text-large, .page4 .text-large {
            color: #fff; /* 年份也改为白色 */
        }
        /* 图表页样式 */
        .chart-page .page-content {
            align-items: center;
            gap: 20px;
            margin-top: 20px;
            color: #fff; /* 改为白色 */
        }
        .chart-container {
            width: 100%;
            height: 380px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            margin-top: 10px;
        }
        /* 排名页样式 - 白色文字 + 长店名缩小字号 */
        .ranking-page .page-content {
            align-items: center;
            gap: 20px;
            color: #fff; /* 改为白色 */
        }
        .ranking-list {
            width: 100%;
            max-height: 70vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            margin-top: 10px;
        }
        .ranking-item {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 15px 20px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: transform 0.3s ease;
            width: 100%;
        }
        .ranking-item.parallax { will-change: transform; }
        .ranking-item .rank {
            font-family: "思源黑体", sans-serif;
            font-size: 1.8em;
            font-weight: 700;
            width: 40px;
            text-align: center;
            flex-shrink: 0;
        }
        .rank-1 { color: #FFD700; }
        .rank-2 { color: #C0C0C0; }
        .rank-3 { color: #CD7F32; }
        .ranking-item .info {
            flex: 1;
            margin-left: 15px;
            overflow: hidden;
        }
        .ranking-item .name {
            font-size: 1.3em;
            font-weight: 500;
            white-space: nowrap;
            text-overflow: ellipsis;
            overflow: hidden;
            line-height: 1.4;
            color: #fff; /* 白色 */
        }
        /* 长店名（>7字符）缩小字号 */
        .ranking-item .name.long-name {
            font-size: 1.0em;
        }
        .ranking-item .score {
            font-family: "思源黑体", sans-serif;
            font-size: 1.1em;
            color: #fff; /* 改为白色 */
            text-align: right;
            flex-shrink: 0;
            width: 120px;
        }
        /* 弹窗样式 */
        .card-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            width: 85%;
            max-width: 400px;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            color: #333333;
        }
        .card-popup.active {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            pointer-events: auto;
        }
        .card-popup .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5em;
            cursor: pointer;
            color: #333333;
        }
        .card-popup .content {
            line-height: 2;
            font-size: 1.2em;
        }
        /* 第12页专属样式 - 白色文字+上移避开小狗+无动画直接显示 */
        .page12 .page-content {
            justify-content: flex-start; /* 上移避开小狗 */
            align-items: center;
            height: 100%;
            padding-top: 80px; /* 大幅上移 */
            color: #fff; /* 白色文字 */
        }
        .page12 .line {
            margin: 10px 0;
            text-align: center;
            font-size: 1.8em; /* 恢复原字号，不放大 */
            font-weight: 500;
        }
        /* 动画 */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }
    </style>
</head>
<body>
    <div id="playOverlay">点击任意位置开始播放</div>
    <div class="page-container">
        <!-- P1 封面 -->
        <section class="page1 active">
            <video class="video-bg" id="video1" loop muted playsinline>
                <source src="https://pridech.github.io/diet20260228/v0369cg10004d6beab7og65pefsj2bmg.mp4" type="video/mp4">
            </video>
            <div class="page-content">
                <div class="title text-large">2025 餐厅评价<br>年度报告</div>
                <div class="subtitle text-small">小琪小辞编</div>
            </div>
        </section>

        <!-- P2 总览数据 -->
        <section class="page2">
            <video class="video-bg" id="video2" loop muted playsinline>
                <source src="https://pridech.github.io/diet20260228/video2.mp4" type="video/mp4">
            </video>
            <div class="page-content">
                <div class="year text-large">2025</div>
                <div class="stats">
                    <div class="text-medium">评价餐厅数量 160</div>
                    <div class="text-medium">平均价格 114.9</div>
                    <div class="text-medium">平均评分 6.22</div>
                </div>
            </div>
        </section>

        <!-- P3 消费类型对比 -->
        <section class="page3">
            <video class="video-bg" id="video3" loop muted playsinline>
                <source src="https://pridech.github.io/diet20260228/video2.mp4" type="video/mp4">
            </video>
            <div class="page-content">
                <div class="year text-large">2025</div>
                <div class="comparison">
                    <div class="text-medium">消费餐厅 108 家</div>
                    <div class="text-small">占比67.5% 均价 109.8・均分 6.43</div>
                    <div class="text-medium">免费餐厅 52 家</div>
                    <div class="text-small">占比32.5% 均价 125.6・均分 5.79</div>
                </div>
            </div>
        </section>

        <!-- P4 两人评分对比 -->
        <section class="page4">
            <video class="video-bg" id="video4" loop muted playsinline>
                <source src="https://pridech.github.io/diet20260228/video2.mp4" type="video/mp4">
            </video>
            <div class="page-content">
                <div class="year text-large">2025</div>
                <div class="scores">
                    <div class="text-medium">小琪 平均评分 6.15</div>
                    <div class="text-medium">小辞 平均评分 6.34</div>
                </div>
            </div>
        </section>

        <!-- P5 四维度分析 -->
        <section class="page5 chart-page">
            <video class="video-bg" id="video5" loop muted playsinline>
                <source src="https://pridech.github.io/diet20260228/video3.mp4" type="video/mp4">
            </video>
            <div class="page-content">
                <div class="chart-title text-medium">小琪小辞四维度评价对比</div>
                <div id="chart21" class="chart-container"></div>
            </div>
        </section>

        <!-- P6 评分分布 -->
        <section class="page6 chart-page">
            <video class="video-bg" id="video6" loop muted playsinline>
                <source src="https://pridech.github.io/diet20260228/video3.mp4" type="video/mp4">
            </video>
            <div class="page-content">
                <div class="chart-title text-medium">餐厅评分分布情况</div>
                <div id="chart22" class="chart-container"></div>
            </div>
        </section>

        <!-- P7 TOP15 餐厅排行榜 -->
        <section class="page7 ranking-page">
            <video class="video-bg" id="video7" loop muted playsinline>
                <source src="https://pridech.github.io/diet20260228/video4.mp4" type="video/mp4">
            </video>
            <div class="page-content">
                <div class="ranking-title text-medium-large">2025 年 TOP15 餐厅排行榜</div>
                <div class="ranking-list">
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 0.1s both;"><span class="rank rank-1">1</span><div class="info"><div class="name">前海沿 青岛菜</div></div><div class="score">8.48 · 236</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 0.2s both;"><span class="rank rank-2">2</span><div class="info"><div class="name">青叶食堂</div></div><div class="score">7.83 · 138</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 0.3s both;"><span class="rank rank-3">3</span><div class="info"><div class="name">南昌米粉</div></div><div class="score">7.76 · 18</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 0.4s both;"><span class="rank">4</span><div class="info"><div class="name long-name">大吉利潮汕牛肉火锅</div></div><div class="score">7.73 · 120</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 0.5s both;"><span class="rank">5</span><div class="info"><div class="name">群乐饭店</div></div><div class="score">7.70 · 115</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 0.6s both;"><span class="rank">6</span><div class="info"><div class="name">金家馅饼</div></div><div class="score">7.69 · 70</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 0.7s both;"><span class="rank">7</span><div class="info"><div class="name">香园茶社</div></div><div class="score">7.66 · 118</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 0.8s both;"><span class="rank">8</span><div class="info"><div class="name">喜鼎</div></div><div class="score">7.65 · 304</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 0.9s both;"><span class="rank">9</span><div class="info"><div class="name long-name">余丞记川渝面馆</div></div><div class="score">7.64 · 36</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 1.0s both;"><span class="rank">10</span><div class="info"><div class="name long-name">风味烩面馆</div></div><div class="score">7.55 · 9</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 1.1s both;"><span class="rank">11</span><div class="info"><div class="name long-name">海底捞火锅</div></div><div class="score">7.53 · 200</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 1.2s both;"><span class="rank">12</span><div class="info"><div class="name long-name">主顾桂林米粉</div></div><div class="score">7.49 · 42</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 1.3s both;"><span class="rank">13</span><div class="info"><div class="name">双姐菜馆</div></div><div class="score">7.49 · 68</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 1.4s both;"><span class="rank">14</span><div class="info"><div class="name long-name">长白山烤肉</div></div><div class="score">7.46 · 160</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 1.5s both;"><span class="rank">15</span><div class="info"><div class="name">笑子</div></div><div class="score">7.45 · 38</div></div>
                </div>
            </div>
        </section>

        <!-- P8 BOT15 餐厅倒数榜 -->
        <section class="page8 ranking-page">
            <video class="video-bg" id="video8" loop muted playsinline>
                <source src="https://pridech.github.io/diet20260228/video4.mp4" type="video/mp4">
            </video>
            <div class="page-content">
                <div class="ranking-title text-medium-large">2025 年 BOT15 餐厅排行榜</div>
                <div class="ranking-list">
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 0.1s both;"><span class="rank rank-1">1</span><div class="info"><div class="name long-name">滇牛 云南酸菜牛肉火锅</div></div><div class="score">2.43 · 140</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 0.2s both;"><span class="rank rank-2">2</span><div class="info"><div class="name long-name">天府老街巷子</div></div><div class="score">2.68 · 80</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 0.3s both;"><span class="rank rank-3">3</span><div class="info"><div class="name long-name">壹兆炭火烤肉 烤鳗鱼</div></div><div class="score">3.04 · 228</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 0.4s both;"><span class="rank">4</span><div class="info"><div class="name long-name">牛嗝嗝大块牛肉饭</div></div><div class="score">3.08 · 44</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 0.5s both;"><span class="rank">5</span><div class="info"><div class="name long-name">52牛家 齐齐哈尔烤肉</div></div><div class="score">3.10 · 158</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 0.6s both;"><span class="rank">6</span><div class="info"><div class="name long-name">v1 coffee 西餐融合店</div></div><div class="score">3.47 · 58</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 0.7s both;"><span class="rank">7</span><div class="info"><div class="name">辽河渡口</div></div><div class="score">3.61 · 268</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 0.8s both;"><span class="rank">8</span><div class="info"><div class="name long-name">红樱桃 新派辽菜（香炉山路店）</div></div><div class="score">3.63 · 130</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 0.9s both;"><span class="rank">9</span><div class="info"><div class="name">肥汁米线</div></div><div class="score">3.82 · 69</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 1.0s both;"><span class="rank">10</span><div class="info"><div class="name">八大碗</div></div><div class="score">4.06 · 109</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 1.1s both;"><span class="rank">11</span><div class="info"><div class="name long-name">在山野云贵川bistro</div></div><div class="score">4.11 · 70</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 1.2s both;"><span class="rank">12</span><div class="info"><div class="name long-name">小薛风味砂锅居</div></div><div class="score">4.15 · 14</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 1.3s both;"><span class="rank">13</span><div class="info"><div class="name long-name">mama tai泰国料理（万象汇店）</div></div><div class="score">4.34 · 72</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 1.4s both;"><span class="rank">14</span><div class="info"><div class="name long-name">独吞塔可</div></div><div class="score">4.44 · 35</div></div>
                    <div class="ranking-item parallax" style="animation: fadeInUp 0.5s ease 1.5s both;"><span class="rank">15</span><div class="info"><div class="name">锦州佬串店</div></div><div class="score">4.68 · 75</div></div>
                </div>
            </div>
        </section>

        <!-- P9 性价比 TOP10 -->
        <section class="page9 ranking-page">
            <video class="video-bg" id="video9" loop muted playsinline>
                <source src="https://pridech.github.io/diet20260228/video4.mp4" type="video/mp4">
            </video>
            <div class="page-content">
                <div class="ranking-title text-medium-large">2025 年性价比 TOP10 餐厅</div>
                <div class="ranking-list">
                    <div class="ranking-item" data-details="餐厅名称：风味烩面馆&#10;总分合计：7.55&#10;消费价格：9元&#10;性价比得分：18.2"><span class="rank rank-1">1</span><div class="info"><div class="name long-name">风味烩面馆</div></div><div class="score">7.55 · 9</div></div>
                    <div class="ranking-item" data-details="餐厅名称：刘八两安徽板面&#10;总分合计：6.02&#10;消费价格：10元&#10;性价比得分：12.5"><span class="rank rank-2">2</span><div class="info"><div class="name long-name">刘八两安徽板面</div></div><div class="score">6.02 · 10</div></div>
                    <div class="ranking-item" data-details="餐厅名称：南昌米粉&#10;总分合计：7.76&#10;消费价格：18元&#10;性价比得分：11.9"><span class="rank rank-3">3</span><div class="info"><div class="name">南昌米粉</div></div><div class="score">7.76 · 18</div></div>
                    <div class="ranking-item" data-details="餐厅名称：黑天鹅蛋糕店&#10;总分合计：6.78&#10;消费价格：12元&#10;性价比得分：10.9"><span class="rank">4</span><div class="info"><div class="name long-name">黑天鹅蛋糕店</div></div><div class="score">6.78 · 12</div></div>
                    <div class="ranking-item" data-details="餐厅名称：安徽淮南牛肉汤烧饼店&#10;总分合计：5.95&#10;消费价格：14元&#10;性价比得分：10.4"><span class="rank">5</span><div class="info"><div class="name long-name">安徽淮南牛肉汤烧饼店</div></div><div class="score">5.95 · 14</div></div>
                    <div class="ranking-item" data-details="餐厅名称：赵记传承&#10;总分合计：6.47&#10;消费价格：13元&#10;性价比得分：9.5"><span class="rank">6</span><div class="info"><div class="name">赵记传承</div></div><div class="score">6.47 · 13</div></div>
                    <div class="ranking-item" data-details="餐厅名称：福源炸串&#10;总分合计：6.12&#10;消费价格：15元&#10;性价比得分：9.1"><span class="rank">7</span><div class="info"><div class="name">福源炸串</div></div><div class="score">6.12 · 15</div></div>
                    <div class="ranking-item" data-details="餐厅名称：甜沫&#10;总分合计：5.34&#10;消费价格：15元&#10;性价比得分：9.0"><span class="rank">8</span><div class="info"><div class="name">甜沫</div></div><div class="score">5.34 · 15</div></div>
                    <div class="ranking-item" data-details="餐厅名称：小红车炸蛋葱油饼&#10;总分合计：5.66&#10;消费价格：12元&#10;性价比得分：8.6"><span class="rank">9</span><div class="info"><div class="name long-name">小红车炸蛋葱油饼</div></div><div class="score">5.66 · 12</div></div>
                    <div class="ranking-item" data-details="餐厅名称：明月麻辣香锅&#10;总分合计：6.37&#10;消费价格：24元&#10;性价比得分：7.6"><span class="rank">10</span><div class="info"><div class="name long-name">明月麻辣香锅</div></div><div class="score">6.37 · 24</div></div>
                </div>
            </div>
        </section>

        <!-- P10 月度消费趋势 -->
        <section class="page10 chart-page">
            <video class="video-bg" id="video10" loop muted playsinline>
                <source src="https://pridech.github.io/diet20260228/video5.mp4" type="video/mp4">
            </video>
            <div class="page-content">
                <div class="chart-title text-medium" style="color:#fff;">小琪小辞・月度消费趋势</div>
                <div id="chart23" class="chart-container"></div>
            </div>
        </section>

        <!-- P11 评分 × 消费类型交叉分析 -->
        <section class="page11 chart-page">
            <video class="video-bg" id="video11" loop muted playsinline>
                <source src="https://pridech.github.io/diet20260228/video5.mp4" type="video/mp4">
            </video>
            <div class="page-content">
                <div class="chart-title text-medium" style="color:#fff;">评分 × 消费交叉分析</div>
                <div id="chart24" class="chart-container"></div>
            </div>
        </section>

        <!-- P12 封底 - 直接显示四行文字，上移不遮挡小狗 -->
        <section class="page12">
            <video class="video-bg" id="video12" loop muted playsinline>
                <source src="https://pridech.github.io/diet20260228/video6.mp4" type="video/mp4">
            </video>
            <div class="page-content">
                <div class="line">幸福就是</div>
                <div class="line">在一起</div>
                <div class="line">吃很多很多很多顿饭</div>
                <div class="line">永远</div>
            </div>
        </section>
    </div>

    <div class="card-popup" id="cardPopup">
        <div class="close-btn" id="closeCard">×</div>
        <div class="content" id="cardContent"></div>
    </div>

    <script>
        // 点击播放
        const playOverlay = document.getElementById('playOverlay');
        const allVideos = document.querySelectorAll('.video-bg');
        playOverlay.addEventListener('click', function() {
            playOverlay.style.display = 'none';
            allVideos.forEach(video => {
                video.play().then(() => {
                    video.classList.add('played');
                }).catch(e => {
                    video.classList.add('played');
                });
            });
        });

        // 翻页核心 - 分页面处理逻辑
        let currentPage = 0;
        const pages = document.querySelectorAll('section');
        const totalPages = pages.length;
        let touchStartY = 0;
        let isScrolling = false; // 仅用于7-9页

        // 7-9页滚动判断
        document.querySelectorAll('.page7 .ranking-list, .page8 .ranking-list, .page9 .ranking-list').forEach(el => {
            el.addEventListener('touchmove', (e) => {
                e.stopPropagation();
                isScrolling = true;
                clearTimeout(window.scrollEndTimer);
                window.scrollEndTimer = setTimeout(() => {
                    isScrolling = false;
                }, 200);
            }, { passive: true });
        });

        // 全局触摸事件
        document.addEventListener('touchstart', (e) => {
            // 7-9页且正在滚动，不记录起始位置
            if ((currentPage >=6 && currentPage <=8) && isScrolling) return;
            touchStartY = e.touches[0].clientY;
        });

        document.addEventListener('touchend', (e) => {
            // 7-9页且正在滚动，不翻页
            if ((currentPage >=6 && currentPage <=8) && isScrolling) return;
            
            const touchEndY = e.changedTouches[0].clientY;
            const deltaY = touchStartY - touchEndY;

            // 流畅翻页逻辑（所有页面通用，7-9页会被上面的判断拦截）
            if (deltaY > 50 && currentPage < totalPages - 1) {
                pages[currentPage].classList.remove('active');
                currentPage++;
                pages[currentPage].classList.add('active');
                // 确保当前页视频播放
                const currentVideo = pages[currentPage].querySelector('.video-bg');
                if (currentVideo && currentVideo.paused) {
                    currentVideo.play().catch(() => {});
                }
                initParallax(); // 仅7-9页生效
            } else if (deltaY < -50 && currentPage > 0) {
                pages[currentPage].classList.remove('active');
                currentPage--;
                pages[currentPage].classList.add('active');
                // 确保当前页视频播放
                const currentVideo = pages[currentPage].querySelector('.video-bg');
                if (currentVideo && currentVideo.paused) {
                    currentVideo.play().catch(() => {});
                }
                initParallax(); // 仅7-9页生效
            }
        });

        // 7-9页视差效果
        function initParallax() {
            if (currentPage <6 || currentPage >8) return; // 仅7-9页
            const currentRankingPage = pages[currentPage];
            const parallaxItems = currentRankingPage.querySelectorAll('.parallax');
            if (parallaxItems.length === 0) return;
            const rankingList = currentRankingPage.querySelector('.ranking-list');
            let lastScrollTop = 0;
            rankingList.addEventListener('scroll', () => {
                const scrollTop = rankingList.scrollTop;
                const direction = scrollTop > lastScrollTop ? 1 : -1;
                lastScrollTop = scrollTop;
                parallaxItems.forEach((item, index) => {
                    const offset = (index * 3 + scrollTop * 0.03) * direction;
                    item.style.transform = `translateY(${offset}px)`;
                });
            });
        }

        // 性价比弹窗
        const cardPopup = document.getElementById('cardPopup');
        const cardContent = document.getElementById('cardContent');
        const closeCard = document.getElementById('closeCard');
        document.querySelectorAll('.page9 .ranking-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.stopPropagation();
                const details = item.getAttribute('data-details');
                cardContent.innerHTML = details.replace(/&#10;/g, '<br>');
                cardPopup.classList.add('active');
            });
        });
        closeCard.addEventListener('click', () => cardPopup.classList.remove('active'));
        cardPopup.addEventListener('click', (e) => {
            if (e.target === cardPopup) cardPopup.classList.remove('active');
        });

        // ECharts 初始化 - 全量真实数据
        // P5 四维度
        const chart21 = echarts.init(document.getElementById('chart21'));
        const option21 = {
            backgroundColor: 'transparent',
            textStyle: { color: '#333333' },
            xAxis: {
                type: 'category',
                data: ["菜品", "环境", "服务", "性价比"],
                name: "评分维度",
                nameLocation: "middle",
                nameGap: 25,
                nameTextStyle: { color: "#333333", fontSize: 12 },
                axisLine: { lineStyle: { color: '#333333' } },
                axisLabel: { color: '#333333', fontSize: 12 },
                splitLine: { show: false }
            },
            yAxis: {
                type: 'value',
                name: "平均分",
                nameLocation: "middle",
                nameGap: 40,
                min: 5.0,
                max: 6.6,
                interval: 0.2,
                nameTextStyle: { color: "#333333", fontSize: 12 },
                axisLine: { lineStyle: { color: '#333333' } },
                axisLabel: { color: '#333333', fontSize: 11, formatter: "{value}" },
                splitLine: { lineStyle: { color: 'rgba(51,51,51,0.2)', type: "dashed" } }
            },
            series: [
                { name: '小琪', type: 'bar', data: [6.33, 5.87, 5.78, 5.51], itemStyle: { color: 'rgba(74, 120, 194, 0.8)', borderColor: "#3A5F98", borderWidth: 2 }, barGap: '20%' },
                { name: '小辞', type: 'bar', data: [6.51, 6.14, 6.06, 5.70], itemStyle: { color: 'rgba(141, 211, 95, 0.8)', borderColor: "#75B84D", borderWidth: 2 } },
                { name: '整体', type: 'bar', data: [6.42, 6.01, 5.92, 5.61], itemStyle: { color: 'rgba(240, 184, 110, 0.8)', borderColor: "#E09F4B", borderWidth: 2 } }
            ],
            legend: { data: ['小琪', '小辞', '整体'], left: "center", top: "10px", orient: "horizontal", itemGap: 20, textStyle: { color: '#333333', fontSize: 12 } },
            tooltip: { trigger: 'axis', backgroundColor: 'rgba(255,255,255,0.9)', textStyle: { color: '#333333', fontSize: 11 }, formatter: "{b}<br/>{a}：{c}" },
            dataZoom: [{ type: "inside", rangeStart: 0, rangeEnd: 100 }],
            toolbox: { show: true, left: "center", top: "50px", itemSize: 16, feature: { saveAsImage: {}, magicType: { type: ["line", "bar"] } }, iconStyle: { color: '#333333' } }
        };
        chart21.setOption(option21);

        // P6 评分分布 - 真实160家数据
        const chart22 = echarts.init(document.getElementById('chart22'));
        const option22 = {
            backgroundColor: 'transparent',
            textStyle: { color: '#333333' },
            tooltip: { trigger: 'item', backgroundColor: 'rgba(255,255,255,0.9)', textStyle: { color: '#333333', fontSize: 11 }, formatter: '{b}：{c}家 ({d}%)' },
            legend: { data: ['低分(0-5)', '中低分(5-6)', '中分(6-7)', '中高分(7-8)', '高分(8-10)'], textStyle: { color: '#333333', fontSize: 12 }, left: 'center', top: '10px' },
            series: [{
                type: 'pie',
                radius: ['30%', '70%'],
                center: ['50%', '60%'],
                data: [
                    { value: 18, name: '低分(0-5)' },
                    { value: 27, name: '中低分(5-6)' },
                    { value: 80, name: '中分(6-7)' },
                    { value: 34, name: '中高分(7-8)' },
                    { value: 1, name: '高分(8-10)' }
                ],
                itemStyle: { color: (p) => ['#F06292', '#FFB74D', '#81C784', '#64B5F6', '#9575CD'][p.dataIndex] },
                label: { color: '#333333', fontSize: 11, formatter: '{b}: {c}家\n({d}%)' },
                labelLine: { show: false },
                avoidLabelOverlap: true
            }]
        };
        chart22.setOption(option22);

        // P10 月度消费趋势 - 文字和图例改为白色
        const chart23 = echarts.init(document.getElementById('chart23'));
        const option23 = {
            backgroundColor: 'transparent',
            textStyle: { color: '#fff' },
            tooltip: { trigger: 'axis', backgroundColor: 'rgba(255,255,255,0.9)', textStyle: { color: '#333333', fontSize: 11 } },
            legend: { data: ['平均价格(元)', '评价餐厅数', '平均总分'], left: "center", top: "10px", textStyle: { color: '#fff', fontSize: 11 } },
            xAxis: { type: 'category', data: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'], axisLine: { lineStyle: { color: '#fff' } }, axisLabel: { color: '#fff', fontSize: 10 }, splitLine: { show: false } },
            yAxis: [
                { type: 'value', name: '分数/餐厅数', min: 0, max: 30, interval: 5, nameTextStyle: { color: '#fff', fontSize: 12 }, axisLine: { lineStyle: { color: '#fff' } }, axisLabel: { color: '#fff', fontSize: 11 }, splitLine: { lineStyle: { color: 'rgba(255,255,255,0.2)', type: "dashed" } } },
                { type: 'value', name: '价格(元)', min: 80, max: 150, interval: 10, nameTextStyle: { color: '#fff', fontSize: 12 }, axisLine: { lineStyle: { color: '#fff' } }, axisLabel: { color: '#fff', fontSize: 11 }, splitLine: { show: false } }
            ],
            series: [
                { name: '平均价格(元)', type: 'line', data: [90.44, 128.59, 112.65, 131.97, 126.62, 134.02, 150, 142, 84.02, 103.07, 101.13, 110.62], yAxisIndex: 1, itemStyle: { color: "#F06292" }, lineStyle: { width: 3 }, symbolSize: 8 },
                { name: '评价餐厅数', type: 'line', data: [9, 9, 11, 17, 13, 9, 10, 12, 12, 15, 15, 24], yAxisIndex: 0, itemStyle: { color: "#81C784" }, lineStyle: { width: 3 }, symbolSize: 8 },
                { name: '平均总分', type: 'line', data: [6.73, 6.34, 5.96, 6.41, 5.91, 6.09, 5.97, 6.06, 6.22, 6.21, 6.35, 6.39], yAxisIndex: 0, itemStyle: { color: "#64B5F6" }, lineStyle: { width: 3 }, symbolSize: 8 }
            ],
            dataZoom: [{ type: "inside", rangeStart: 0, rangeEnd: 100 }]
        };
        chart23.setOption(option23);

        // P11 交叉分析 - 文字和图例改为白色
        const chart24 = echarts.init(document.getElementById('chart24'));
        const option24 = {
            backgroundColor: 'transparent',
            textStyle: { color: '#fff' },
            tooltip: { trigger: 'axis', backgroundColor: 'rgba(255,255,255,0.9)', textStyle: { color: '#333333', fontSize: 11 } },
            legend: { data: ['消费餐厅', '免费餐厅'], left: "center", top: "10px", textStyle: { color: '#fff', fontSize: 12 } },
            xAxis: { type: 'category', data: ['5分以下', '5-6分', '6-7分', '7分以上'], axisLine: { lineStyle: { color: '#fff' } }, axisLabel: { color: '#fff', fontSize: 12 } },
            yAxis: { type: 'value', name: '餐厅数量', nameTextStyle: { color: '#fff', fontSize: 12 }, axisLine: { lineStyle: { color: '#fff' } }, axisLabel: { color: '#fff', fontSize: 11 }, splitLine: { lineStyle: { color: 'rgba(255,255,255,0.2)', type: "dashed" } } },
            series: [
                { name: '消费餐厅', type: 'bar', data: [5, 20, 75, 8], itemStyle: { color: 'rgba(74, 120, 194, 0.8)' }, barGap: '20%' },
                { name: '免费餐厅', type: 'bar', data: [10, 15, 25, 2], itemStyle: { color: 'rgba(141, 211, 95, 0.8)' } }
            ]
        };
        chart24.setOption(option24);

        // 响应式适配
        window.addEventListener('resize', () => {
            chart21.resize();
            chart22.resize();
            chart23.resize();
            chart24.resize();
        });
    </script>
</body>
</html>
